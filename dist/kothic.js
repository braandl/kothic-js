/*
 (c) 2011-2019, Darafei Praliaskouski, Vladimir Agafonkin, Maksim Gurtovenko, Stephan Brandt
 Kothic JS is a full-featured JavaScript map rendering engine using HTML5 Canvas.
 Built on 08-08-2024 | https://github.com/kothic/kothic-js
*/
!function i(a,r,n){function l(t,e){if(!r[t]){if(!a[t]){var o="function"==typeof require&&require;if(!e&&o)return o(t,!0);if(s)return s(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}o=r[t]={exports:{}},a[t][0].call(o.exports,function(e){return l(a[t][1][e]||e)},o,o.exports,i,a,r,n)}return r[t].exports}for(var s="function"==typeof require&&require,e=0;e<n.length;e++)l(n[e]);return l}({1:[function(e,t,o){e("./kothic.js"),e("./renderer/line.js"),e("./renderer/path.js"),e("./renderer/polygon.js"),e("./renderer/texticons.js"),e("./renderer/shields.js"),e("./renderer/text.js"),e("./style/mapcss.js"),e("./style/style.js"),e("./style/osmosnimki.js"),e("./utils/collisions.js"),e("./utils/geom.js"),e("./utils/rbush.js")},{"./kothic.js":2,"./renderer/line.js":3,"./renderer/path.js":4,"./renderer/polygon.js":5,"./renderer/shields.js":6,"./renderer/text.js":7,"./renderer/texticons.js":8,"./style/mapcss.js":9,"./style/osmosnimki.js":10,"./style/style.js":11,"./utils/collisions.js":12,"./utils/geom.js":13,"./utils/rbush.js":14}],2:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var m=i(e("./style/mapcss")),g=i(e("./utils/collisions")),x=i(e("./style/style")),y=i(e("./renderer/polygon")),w=i(e("./renderer/line")),c=i(e("./renderer/shields")),h=i(e("./renderer/texticons"));function i(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=a(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==a(e)?e:e+""}(i.key),i)}}o.default=function(){function p(){if(!(this instanceof p))throw new TypeError("Cannot call a class as a function")}return e=p,o=[{key:"render",value:function(e,t,o,i){var a,r,n,l,s,f,u,c,h,d,y;null!=t&&("string"==typeof e&&(e=document.getElementById(e)),a=i&&i.styles||[],m.default.shared._locales=i&&i.locales||[],r=Math.max(window.devicePixelRatio||1,2),n=e.width,l=e.height,1!==r&&(e.style.width=n+"px",e.style.height=l+"px",e.width=e.width*r,e.height=e.height*r),(s=e.getContext("2d")).scale(r,r),f=t.granularity,u=n/f,c=l/f,h=new g.default(l,n),d=x.default.populateLayers(t.features,o,a),y=p.getLayerIds(d),x.default.setStyles(s,x.default.defaultCanvasStyles),p.getFrame(function(){p._renderBackground(s,n,l,o,a),p._renderGeometryFeatures(y,d,s,u,c,f),i&&i.onRenderComplete&&i.onRenderComplete(),p.getFrame(function(){p._renderTextAndIcons(y,d,s,u,c,h)})}))}},{key:"_renderCollisions",value:function(e,t){var o,i,a;if(t.leaf)for(o=0,i=t.children.length;o<i;o++)e.strokeStyle="red",e.lineWidth=1,a=t.children[o],e.strokeRect(Math.round(a[0]),Math.round(a[1]),Math.round(a[2]-a[0]),Math.round(a[3]-a[1]));else for(o=0,i=t.children.length;o<i;o++)p._renderCollisions(e,t.children[o])}},{key:"getLayerIds",value:function(e){return Object.keys(e).sort(function(e,t){return parseInt(e,10)-parseInt(t,10)})}},{key:"getFrame",value:function(e){(window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame).call(window,e)}},{key:"_renderBackground",value:function(e,t,o,i,a){function r(){e.fillRect(-1,-1,t+1,o+1)}var n,l=m.default.shared.restyle(a,{},{},i,"canvas","canvas");for(n in l)y.default.shared.fill(e,l[n],r)}},{key:"_renderGeometryFeatures",value:function(e,t,o,i,a,r){for(var n,l,s,f,u,c,h={},d=0;d<e.length;d++)for(s=t[e[d]],c=h._bg=h._bg||{},u=h[e[d]]=h[e[d]]||{},n=0,l=s.length;n<l;n++)("fill-color"in(f=s[n].style)||"fill-image"in f)&&("background"===f["fill-position"]?(c.polygons=c.polygons||[],c):(u.polygons=u.polygons||[],u)).polygons.push(s[n]),"casing-width"in f&&(u.casings=u.casings||[],u.casings.push(s[n])),"width"in f&&(u.lines=u.lines||[],u.lines.push(s[n]));for(e=["_bg"].concat(e),d=0;d<e.length;d++)if(u=h[e[d]]){if(u.polygons)for(n=0,l=u.polygons.length;n<l;n++)y.default.shared.render(o,u.polygons[n],u.polygons[n+1],i,a,r);if(u.casings)for(o.lineCap="butt",n=0,l=u.casings.length;n<l;n++)w.default.shared.renderCasing(o,u.casings[n],u.casings[n+1],i,a,r);if(u.lines)for(o.lineCap="round",n=0,l=u.lines.length;n<l;n++)w.default.shared.render(o,u.lines[n],u.lines[n+1],i,a,r)}}},{key:"_renderTextAndIcons",value:function(e,t,o,i,a,r){for(var n,l=0;l<e.length;l++){for(var s=t[e[l]],f=s.length,u=f-1;0<=u;u--)(n=s[u].style).hasOwnProperty("icon-image")&&!n.text&&h.default.render(o,s[u],r,i,a,!1,!0);for(u=f-1;0<=u;u--)!(n=s[u].style).hasOwnProperty("icon-image")&&n.text&&h.default.render(o,s[u],r,i,a,!0,!1);for(u=f-1;0<=u;u--)(n=s[u].style).hasOwnProperty("icon-image")&&n.text&&h.default.render(o,s[u],r,i,a,!0,!0);for(u=f-1;0<=u;u--)(n=s[u].style)["shield-text"]&&c.default.render(o,s[u],r,i,a)}return[]}}],(t=null)&&r(e.prototype,t),o&&r(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,o}()},{"./renderer/line":3,"./renderer/polygon":5,"./renderer/shields":6,"./renderer/texticons":8,"./style/mapcss":9,"./style/style":11,"./utils/collisions":12}],3:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var s=i(e("./path")),f=i(e("../style/style")),u=i(e("../style/mapcss"));function i(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=a(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==a(e)?e:e+""}(i.key),i)}}var n=null;o.default=function(){function e(){if(this instanceof e)return null==n&&((n=this).pathOpened=!1),n;throw new TypeError("Cannot call a class as a function")}return t=e,i=[{key:"shared",get:function(){return new e}}],(o=[{key:"renderCasing",value:function(e,t,o,i,a,r){var n=t.style,l=o&&o.style;this.pathOpened||(this.pathOpened=!0,e.beginPath()),new s.default(e,t,n["casing-dashes"]||n.dashes,!1,i,a,r),o&&l.width===n.width&&l["casing-width"]===n["casing-width"]&&l["casing-color"]===n["casing-color"]&&l["casing-dashes"]===n["casing-dashes"]&&l["casing-opacity"]===n["casing-opacity"]||(f.default.setStyles(e,{lineWidth:2*n["casing-width"]+(n.hasOwnProperty("width")?n.width:0),strokeStyle:n["casing-color"]||"#000000",lineCap:n["casing-linecap"]||n.linecap||"butt",lineJoin:n["casing-linejoin"]||n.linejoin||"round",globalAlpha:n["casing-opacity"]||1}),e.stroke(),this.pathOpened=!1)}},{key:"render",value:function(e,t,o,i,a,r){var n=t.style,l=o&&o.style;this.pathOpened||(this.pathOpened=!0,e.beginPath()),new s.default(e,t,n.dashes,!1,i,a,r),o&&l.width===n.width&&l.color===n.color&&l.image===n.image&&l.opacity===n.opacity||(!("color"in n)&&"image"in n||(i=t="round",(a=n.width||1)<=2&&(t="miter",i="butt"),f.default.setStyles(e,{lineWidth:a,strokeStyle:n.color||"#000000",lineCap:n.linecap||i,lineJoin:n.linejoin||t,globalAlpha:n.opacity||1,miterLimit:4}),e.stroke()),"image"in n&&(r=u.default.getImage(n.image))&&(f.default.setStyles(e,{strokeStyle:e.createPattern(r,"repeat")||"#000000",lineWidth:n.width||1,lineCap:n.linecap||"round",lineJoin:n.linejoin||"round",globalAlpha:n.opacity||1}),e.stroke()),this.pathOpened=!1)}}])&&r(t.prototype,o),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,o,i}()},{"../style/mapcss":9,"../style/style":11,"./path":4}],4:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var k=(e=e("../utils/geom"))&&e.__esModule?e:{default:e};function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=a(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==a(e)?e:e+""}(i.key),i)}}o.default=function(){function _(e,t,o,i,a,r,n){if(!(this instanceof _))throw new TypeError("Cannot call a class as a function");var l=t.type,s=t.coordinates;"Polygon"===l?(s=[s],l="MultiPolygon"):"LineString"===l&&(s=[s],l="MultiLineString");var f,u,c,h,d,y,p,m,g,x,w,v=s.length;if("MultiPolygon"===l)for(b=0;b<v;b++)for(u=0,h=s[b].length;u<h;u++)for(d=(c=s[b][u]).length,y=c[0],f=0;f<=d;f++)p=c[f]||c[0],m=k.default.transformPoint(p,a,r),0===f?(e.moveTo(m[0],m[1]),o?e.setLineDash(o):e.setLineDash([])):!i&&_.checkSameBoundary(p,y,n)?e.moveTo(m[0],m[1]):e.lineTo(m[0],m[1]),y=p;else if("MultiLineString"===l)for(var b=0;b<v;b++)for(d=(c=s[b]).length,f=0;f<d;f++){if(p=c[f],(0===f||f===d-1)&&_.isTileBoundary(p,n)){for(u=f;!((u=f?u-1:u+1)<0||d<=u)&&(y=c[u],g=p[0]-y[0],x=p[1]-y[1],(w=Math.sqrt(g*g+x*x))<=2););if(u<0||d<=u)break;p[0]=p[0]+50*g/w,p[1]=p[1]+50*x/w}m=k.default.transformPoint(p,a,r),0===f?(e.moveTo(m[0],m[1]),o?e.setLineDash(o):e.setLineDash([])):e.lineTo(m[0],m[1])}}return e=_,o=[{key:"isTileBoundary",value:function(e,t){var o=0;return 0===e[0]?o|=1:e[0]===t&&(o|=2),0===e[1]?o|=4:e[1]===t&&(o|=8),o}},{key:"checkSameBoundary",value:function(e,t,o){e=_.isTileBoundary(e,o);return e?e&_.isTileBoundary(t,o):0}}],(t=null)&&i(e.prototype,t),o&&i(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,o}()},{"../utils/geom":13}],5:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var a=i(e("../style/mapcss")),r=i(e("../style/style")),s=i(e("./path"));function i(e){return e&&e.__esModule?e:{default:e}}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function l(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=n(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=n(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==n(e)?e:e+""}(i.key),i)}}var f=null;o.default=function(){function e(){if(this instanceof e)return f=null==f?this:f;throw new TypeError("Cannot call a class as a function")}return t=e,i=[{key:"shared",get:function(){return new e}}],(o=[{key:"render",value:function(e,t,o,i,a,r){var n=t.style,l=o&&o.style;this.pathOpened||(this.pathOpened=!0,e.beginPath()),new s.default(e,t,!1,!0,i,a,r),o&&l["fill-color"]===n["fill-color"]&&l["fill-image"]===n["fill-image"]&&l["fill-opacity"]===n["fill-opacity"]||(this.fill(e,n),this.pathOpened=!1)}},{key:"fill",value:function(e,t,o){var i=t["fill-opacity"]||t.opacity;t.hasOwnProperty("fill-color")&&(r.default.setStyles(e,{fillStyle:t["fill-color"]||"#000000",globalAlpha:i||1}),o?o():e.fill()),t.hasOwnProperty("fill-image")&&(t=a.default.getImage(t["fill-image"]))&&(r.default.setStyles(e,{fillStyle:e.createPattern(t,"repeat"),globalAlpha:i||1}),o?o():e.fill())}}])&&l(t.prototype,o),i&&l(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,o,i}()},{"../style/mapcss":9,"../style/style":11,"./path":4}],6:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var g=i(e("../utils/geom")),x=i(e("../style/mapcss")),w=i(e("../style/style"));function i(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=a(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==a(e)?e:e+""}(i.key),i)}}o.default=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function")}return t=e,i=[{key:"render",value:function(e,t,o,i,a){var r,n,l,s,f,u=t.style,c=g.default.getReprPoint(t),h=!1;if(c&&(r=g.default.transformPoint(c,i,a),!u["shield-image"]||(n=x.default.getImage(u["icon-image"])))){w.default.setStyles(e,{font:w.default.getFontString(u["shield-font-family"]||u["font-family"],u["shield-font-size"]||u["font-size"],u),fillStyle:u["shield-text-color"]||"#000000",globalAlpha:u["shield-text-opacity"]||u.opacity||1,textAlign:"center",textBaseline:"middle"});var d=String(u["shield-text"]),y=e.measureText(d).width,p=y+2,m=1.8*(y/d.length);if("LineString"===t.type){if(l=g.default.getPolyLength(t.coordinates),Math.max(m/a,p/i)>l)return;for(s=0,f=1;s<l/2&&(c=g.default.getAngleAndCoordsAtLength(t.coordinates,l/2+f*s,0));s+=Math.max(l/30,m/i),f*=-1)if(c=[c[1],c[2]],r=g.default.transformPoint(c,i,a),!(n&&"true"!==u["allow-overlap"]&&o.checkPointWH(r,n.width,n.height,t.kothicId)||"true"!==u["allow-overlap"]&&o.checkPointWH(r,p,m,t.kothicId))){h=!0;break}}h&&(u["shield-casing-width"]&&(w.default.setStyles(e,{fillStyle:u["shield-casing-color"]||"#000000",globalAlpha:u["shield-casing-opacity"]||u.opacity||1}),y=u["shield-casing-width"]+(u["shield-frame-width"]||0),e.fillRect(r[0]-p/2-y,r[1]-m/2-y,p+2*y,m+2*y)),u["shield-frame-width"]&&(w.default.setStyles(e,{fillStyle:u["shield-frame-color"]||"#000000",globalAlpha:u["shield-frame-opacity"]||u.opacity||1}),e.fillRect(r[0]-p/2-(u["shield-frame-width"]||0),r[1]-m/2-(u["shield-frame-width"]||0),p+2*(u["shield-frame-width"]||0),m+2*(u["shield-frame-width"]||0))),u["shield-color"]&&(w.default.setStyles(e,{fillStyle:u["shield-color"]||"#000000",globalAlpha:u["shield-opacity"]||u.opacity||1}),e.fillRect(r[0]-p/2,r[1]-m/2,p,m)),n&&e.drawImage(n,Math.floor(r[0]-n.width/2),Math.floor(r[1]-n.height/2)),w.default.setStyles(e,{fillStyle:u["shield-text-color"]||"#000000",globalAlpha:u["shield-text-opacity"]||u.opacity||1}),e.fillText(d,r[0],Math.ceil(r[1])),n&&o.addPointWH(r,n.width,n.height,0,t.kothicId),o.addPointWH(r,m,p,(parseFloat(u["shield-casing-width"])||0)+(parseFloat(u["shield-frame-width"])||0)+(parseFloat(u["-x-mapnik-min-distance"])||30),t.kothicId))}}}],(o=null)&&r(t.prototype,o),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,o,i}()},{"../style/mapcss":9,"../style/style":11,"../utils/geom":13}],7:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var _=(e=e("../utils/geom"))&&e.__esModule?e:{default:e};function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=a(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==a(e)?e:e+""}(i.key),i)}}o.default=function(){function b(e,t,o,i,a){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var r=e.measureText(o).width,n=o.length,l=_.default.getPolyLength(t);if(!(l<r)){for(var s,f,u,c,h,d,y,p=b.getWidth(e,"a"),m=0,g=!1,x=Math.PI/6;m<2;){for(f=m?b.getWidth(e,o.charAt(0)):(l-r)/2,u=null,c=[],v=h=0;v<n;v++){if(s=o.charAt(v),y=b.getWidth(e,s),d=_.default.getAngleAndCoordsAtLength(t,f,y),l<=f||!d){m++,c=[],g&&(t.reverse(),g=!1);break}if(u=u||d[0],b.checkCollision(a,e,s,d,p)||Math.abs(u-d[0])>x)f+=y,v=-1,c=[],h=0;else{for(;y<d[3]&&v<n;){if(v++,s+=o.charAt(v),y=b.getWidth(e,s),b.checkCollision(a,e,s,d,p)){f+=y,c=[],h=v=0,s=o.charAt(v),y=b.getWidth(e,s),d=_.default.getAngleAndCoordsAtLength(t,f,y);break}if(y>=d[3]){v--,s=s.slice(0,-1),y=b.getWidth(e,s);break}}d&&((d[0]>Math.PI/2||d[0]<-Math.PI/2)&&(h+=s.length),u=d[0],d.push(s),c.push(d),f+=y)}}if(n/2<h&&(t.reverse(),c=[],g=!g||(m++,t.reverse(),!1)),2<=m)return;if(0<c.length)break}for(var w=c.length,v=0;i&&v<w;v++)b.renderText(e,c[v],!0);for(v=0;v<w;v++)d=c[v],b.renderText(e,d),b.addCollision(a,e,d[4],d,p)}}return e=b,o=[{key:"getWidth",value:function(e,t){return e.measureText(t).width}},{key:"getTextCenter",value:function(e,t){return[e[1]+.5*Math.cos(e[0])*t,e[2]+.5*Math.sin(e[0])*t]}},{key:"getCollisionParams",value:function(e,t,o){var i=1.5*e,a=Math.abs(Math.cos(t[0])),r=Math.abs(Math.sin(t[0])),n=a*e+r*i,r=r*e+a*i;return[b.getTextCenter(t,e+2*(o||0)),n,r,0]}},{key:"checkCollision",value:function(e,t,o,i,a){for(var r=b.getWidth(t,o),n=0;n<r;n+=a)if(e.checkPointWH.apply(e,b.getCollisionParams(a,i,n)))return!0;return!1}},{key:"addCollision",value:function(e,t,o,i,a){for(var r=b.getWidth(t,o),n=[],l=0;l<r;l+=a)n.push(b.getCollisionParams(a,i,l));e.addPoints(n)}},{key:"renderText",value:function(e,t,o){var i=t[4],a=b.getTextCenter(t,b.getWidth(e,i));e.translate(a[0],a[1]),e.rotate(t[0]),e[o?"strokeText":"fillText"](i,0,0),e.rotate(-t[0]),e.translate(-a[0],-a[1])}}],(t=null)&&i(e.prototype,t),o&&i(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,o}()},{"../utils/geom":13}],8:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var g=i(e("../style/style")),x=i(e("../utils/geom")),w=i(e("../style/mapcss")),v=i(e("./text"));function i(e){return e&&e.__esModule?e:{default:e}}function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=a(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==a(e)?e:e+""}(i.key),i)}}o.default=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function")}return t=e,i=[{key:"render",value:function(e,t,o,i,a,r,n){var l,s,f,u=t.style;if(n||r&&"LineString"!==t.type){var c=x.default.getReprPoint(t);if(!c)return;c=x.default.transformPoint(c,i,a)}if(n){if(!(l=w.default.getImage(u["icon-image"])))return;if(s=l.width,f=l.height,(u["icon-width"]||u["icon-height"])&&(u["icon-width"]&&(s=u["icon-width"],f=l.height*s/l.width),u["icon-height"])&&(f=u["icon-height"],u["icon-width"]||(s=l.width*f/l.height)),"true"!==u["allow-overlap"]&&o.checkPointWH(c,s,f,t.kothicId))return}var h=String(u.text).trim();if(r&&h){g.default.setStyles(e,{lineWidth:2*u["text-halo-radius"],font:g.default.getFontString(u["font-family"],u["font-size"],u)});r=u.hasOwnProperty("text-halo-radius");if(g.default.setStyles(e,{fillStyle:u["text-color"]||"#000000",strokeStyle:u["text-halo-color"]||"#ffffff",globalAlpha:u["text-opacity"]||u.opacity||1,textAlign:"center",textBaseline:"middle"}),"uppercase"===u["text-transform"]?h=h.toUpperCase():"lowercase"===u["text-transform"]?h=h.toLowerCase():"capitalize"===u["text-transform"]&&(h=h.replace(/(^|\s)\S/g,function(e){return e.toUpperCase()})),"Polygon"===t.type||"Point"===t.type){var d=e.measureText(h).width,y=d,d=2.5*(d/h.length),p=u["text-offset"]||0;if("true"!==u["text-allow-overlap"]&&o.checkPointWH([c[0],c[1]+p],y,d,t.kothicId))return;r&&e.strokeText(h,c[0],c[1]+p),e.fillText(h,c[0],c[1]+p);var m=u["-x-kot-min-distance"]||20;o.addPointWH([c[0],c[1]+p],y,d,m,t.kothicId)}else"LineString"===t.type&&(p=x.default.transformPoints(t.coordinates,i,a),new v.default(e,p,h,r,o))}n&&(e.drawImage(l,Math.floor(c[0]-s/2),Math.floor(c[1]-f/2),s,f),y=parseFloat(u["-x-kot-min-distance"])||0,o.addPointWH(c,s,f,y,t.kothicId))}}],(o=null)&&r(t.prototype,o),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,o,i}()},{"../style/mapcss":9,"../style/style":11,"../utils/geom":13,"./text":7}],9:[function(e,t,o){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=a(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==a(e)?e:e+""}(i.key),i)}}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var r=null;o.default=function(){function s(){if(this instanceof s)return null==r&&((r=this)._styles={},this._availableStyles=[],this._images={},this._locales=[],this._presence_tags=[],this._value_tags=[],this._cache={},this._debug={hit:0,miss:0}),r;throw new TypeError("Cannot call a class as a function")}return e=s,o=[{key:"shared",get:function(){return new s}},{key:"onError",value:function(){}},{key:"onImagesLoad",value:function(){}},{key:"e_min",value:function(){return Math.min.apply(null,arguments)}},{key:"e_max",value:function(){return Math.max.apply(null,arguments)}},{key:"e_any",value:function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e]&&""!==arguments[e])return arguments[e];return""}},{key:"e_num",value:function(e){return isNaN(parseFloat(e))?"":parseFloat(e)}},{key:"e_str",value:function(e){return e}},{key:"e_int",value:function(e){return parseInt(e,10)}},{key:"e_tag",value:function(e,t){return e.hasOwnProperty(t)&&null!==e[t]?t:""}},{key:"e_prop",value:function(e,t){return e.hasOwnProperty(t)&&null!==e[t]?e[t]:""}},{key:"e_sqrt",value:function(e){return Math.sqrt(e)}},{key:"e_boolean",value:function(e,t,o){return void 0===t&&(t="true"),void 0===o&&(o="false"),"0"===e||"false"===e||""===e?o:t}},{key:"e_metric",value:function(e){return/\d\s*mm$/.test(e)?1e3*parseInt(e,10):/\d\s*cm$/.test(e)?100*parseInt(e,10):/\d\s*dm$/.test(e)?10*parseInt(e,10):/\d\s*km$/.test(e)?.001*parseInt(e,10):/\d\s*in$/.test(e)?.0254*parseInt(e,10):/\d\s*ft$/.test(e)?.3048*parseInt(e,10):parseInt(e,10)}},{key:"e_zmetric",value:function(e){return s.shared.e_metric(e)}},{key:"e_localize",value:function(e,t){for(var o,i=s.shared._locales,a=0;a<i.length;a++)if(e[o=t+":"+i[a]])return e[o];return e[t]}},{key:"loadStyle",value:function(e,t,o,i,a,r){var n;if(o=o||[],i=i||[],a)for(n=0;n<a.length;n++)s.shared._presence_tags.indexOf(a[n])<0&&s.shared._presence_tags.push(a[n]);if(r)for(n=0;n<r.length;n++)s.shared._value_tags.indexOf(r[n])<0&&s.shared._value_tags.push(r[n]);s.shared._styles[e]={restyle:t,images:o,external_images:i,textures:{},sprite_loaded:!o,external_images_loaded:!i.length},s.shared._availableStyles.push(e)}},{key:"_onImagesLoad",value:function(e){s.shared._styles[e].external_images_loaded&&s.shared._styles[e].sprite_loaded&&s.onImagesLoad()}},{key:"preloadSpriteImage",value:function(t,e){var o=s.shared._styles[t]._images,i=new Image;delete s.shared._styles[t]._images,i.onload=function(){for(var e in o)o.hasOwnProperty(e)&&(o[e].sprite=i,s.shared._images[e]=o[e]);s.shared._styles[t].sprite_loaded=!0,s._onImagesLoad(t)},i.onerror=function(e){s.onError(e)},i.src=e}},{key:"preloadExternalImages",value:function(o,e){var t,i=s.shared._styles[o].external_images,a=(delete s.shared._styles[o].external_images,e=e||"",i.length),r=0;for(t=0;t<a;t++)!function(e){var t=new Image;t.onload=function(){r++,s.shared._images[e]={sprite:t,height:t.height,width:t.width,offset:0},r===a&&(s.shared._styles[o].external_images_loaded=!0,s._onImagesLoad(o))},t.onerror=function(){++r===a&&(s.shared._styles[o].external_images_loaded=!0,s._onImagesLoad(o))},t.src=e}(e+i[t])}},{key:"getImage",value:function(e){var t,o=s.shared._images[e];return o&&o.sprite&&((t=document.createElement("canvas")).width=o.width,t.height=o.height,t.getContext("2d").drawImage(o.sprite,0,o.offset,o.width,o.height,0,0,o.width,o.height),o=s.shared._images[e]=t),o}}],(t=[{key:"availableStyles",get:function(){return this._availableStyles}},{key:"invalidateCache",value:function(){this._cache={}}},{key:"getTagKeys",value:function(e,t,o,i){for(var a=[],r=0;r<this._presence_tags.length;r++)e.hasOwnProperty(this._presence_tags[r])&&a.push(this._presence_tags[r]);for(r=0;r<this._value_tags.length;r++)e.hasOwnProperty(this._value_tags[r])&&a.push(this._value_tags[r]+":"+e[this._value_tags[r]]);return[t,o,i,a.join(":")].join(":")}},{key:"restyle",value:function(e,t,o,i,a){var r,n=this.getTagKeys(t,o,i,a),l=this._cache[n]||{};if(this._cache.hasOwnProperty(n))this._debug.hit+=1;else{for(this._debug.miss+=1,r=0;r<e.length;r++)l=s.shared._styles[e[r]].restyle(l,t,o,i,a);this._cache[n]=l}return l}}])&&i(e.prototype,t),o&&i(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,o}()},{}],10:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var f=(e=e("./mapcss"))&&e.__esModule?e:{default:e};function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=a(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==a(e)?e:e+""}(i.key),i)}}o.default=function(){function e(){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");this.sprite_images={},this.external_images=[],this.presence_tags=["shop"],this.value_tags=["color","amenity","pk","building ","wall","surface","marking","service","addr:housenumber","population","leisure","waterway","aeroway","landuse","barrier","colour","railway","oneway","religion","tourism","admin_level","transport","name","building","place","residential","highway","ele","living_street","natural","boundary","capital"],f.default.loadStyle("styles/contagt",this.restyle,this.sprite_images,this.external_images,this.presence_tags,this.value_tags),f.default.preloadExternalImages("styles/contagt")}return t=e,(o=[{key:"restyle",value:function(e,t,o,i,a){var r={},n={},l={},s={};return"background"===t.surface&&(r["fill-color"]="#FFFFFF",r["fill-opacity"]=1,r["z-index"]=1),"floor"===t.surface&&(r["fill-color"]="#F5F4FF",r["fill-opacity"]=1,r["z-index"]=31),"steps"===t.surface&&"area"===a&&(r["fill-color"]="#FFA384",r.opacity=1,r["z-index"]=33),"elevator"===t.surface&&(r["fill-color"]="#CCA384",r.opacity=1,r["z-index"]=33),"elevator"===t.surface&&"area"===a&&(r["fill-color"]="#CCA384",r.opacity=1,r["z-index"]=33),"steps"===t.highway&&(r["fill-color"]="#FFA384",r["fill-opacity"]=1,r["z-index"]=33),"elevator"===t.highway&&(r["fill-color"]="#CCA384",r["fill-opacity"]=1,r["z-index"]=33),"balcony"===t.surface&&"area"===a&&(r["fill-color"]="#875646",r["fill-opacity"]=.6,r["z-index"]=33),"door"===t.surface&&"line"==a&&(r.color="#DBDBDB",r.width=1,r["z-index"]=39),"solid"===t.surface&&"area"===a&&(r["fill-color"]="#0B0811",r["fill-opacity"]=.9,r["z-index"]=30),"transparent"===t.surface&&"area"===a&&(r["fill-color"]="#FFF",r["fill-opacity"]=.4,r["z-index"]=30),"plant"===t.surface&&"area"===a&&(r["fill-color"]="#83DF60",r["fill-opacity"]=.9,r["z-index"]=30),"sand"===t.surface&&"area"===a&&(r["fill-color"]="#FDD485",r.color="#000000",r.opacity=.8,r["fill-opacity"]=.9,r.width=1.5,r["z-index"]=30,r.dashes=[9,9]),"concrete"===t.surface&&"area"===a&&(r["fill-color"]="#DDDDDD",r["fill-opacity"]=.9,r["z-index"]=30,r.color="#222222",r.width=1.5,r.opacity=.6,r.dashes=[9,3]),"paving_slab"===t.surface&&"area"===a&&(r["fill-color"]="#E0D0DB",r.color="#222222",r["fill-opacity"]=.6,r.width=1.5,r["z-index"]=30,r.dashes=[5,2]),"door"===t.surface&&"area"===a&&(r["fill-color"]="#607F84",r["fill-opacity"]=.6,r.color="#000000",r.width=1.5,r["z-index"]=39),"green"===t.surface&&"area"===a&&(r["fill-color"]="#88C037",r["fill-opacity"]=.2,r["z-index"]=30),"window"===t.surface&&"area"===a&&(r["fill-color"]="#13C5CF",r["fill-opacity"]=.3,r.color="#000000",r.width=1.5,r["z-index"]=35),"sanitary"==t.surface&&"area"==a&&(r["fill-color"]="#EECFFC",r["fill-opacity"]=1,r["z-index"]=36),"beverages"==t.surface&&"area"==a&&(r["fill-color"]="#E3EFEA",r["fill-opacity"]=1,r["z-index"]=36),"room"==t.surface&&"area"==a&&(r["fill-color"]="#E9E9E9",r["fill-opacity"]=1,r["z-index"]=36),"yes"===t.handrail&&(r.color="#111111",r.width=1.5,r["z-index"]=27,r.dashes=[5,5]),"way"===i&&"yes"===t.wall&&o<12&&(r.color="#000000",r.width=.5,r["z-index"]=27),"yes"===t.wall&&o<16&&12<=o&&(r.color="#000000",r.width=1,r["z-index"]=27),"yes"===t.wall&&16<=o&&(r.color="#000000",r.width=1.5,r["z-index"]=27),16<=t.wall&&(r.color="#000000",r.width=1.5,r["z-index"]=27),"yes"==t.wall&&"area"==a&&(r["fill-color"]="#E9E9E9",r["fill-opacity"]=2,r["z-index"]=22),"yes"===t.building&&"area"==a&&(r["fill-color"]="#DDDAD3",r["fill-opacity"]=1,r.color="#CCC9C4",r.width=1.5,r["z-index"]=8),"area"===a&&"coastline"===t.natural&&(r["fill-color"]="#fcf8e4",r["-x-mapnik-layer"]="bottom"),"area"===a&&"glacier"===t.natural&&(r["fill-color"]="#fcfeff"),"area"===a&&"park"===t.leisure&&(r["fill-color"]="#c4e9a4",r["z-index"]=3),("area"===a&&"garden"===t.leisure||"area"===a&&"orchard"===t.landuse)&&(r["z-index"]=3),"area"===a&&"scrub"===t.natural&&(r["fill-color"]="#e5f5dc",r["z-index"]=3),"area"===a&&"heath"===t.natural&&(r["fill-color"]="#ecffe5",r["z-index"]=3),("area"===a&&"industrial"===t.landuse||"area"===a&&"military"===t.landuse)&&(r["fill-color"]="#ddd8da",r["z-index"]=3),"area"===a&&"parking"===t.amenity&&(r["fill-color"]="#ecedf4",r["z-index"]=3),("area"===a&&"forest"===t.natural||"area"===a&&"wood"===t.natural||"area"===a&&"forest"===t.landuse||"area"===a&&"wood"===t.landuse)&&(r["fill-color"]="#d6f4c6",r["z-index"]=3),"area"===a&&"garages"===t.landuse&&10<=o&&(r["fill-color"]="#ddd8da",r["z-index"]=3),("area"===a&&"forest"===t.natural||"area"===a&&"wood"===t.natural&&10<=o||"area"===a&&"forest"===t.landuse||"area"===a&&"wood"===t.landuse)&&(r.text=f.default.e_localize(t,"name"),r["text-offset"]=0,r["font-size"]="10",r["font-family"]="DejaVu Serif Italic",r["text-color"]="green",r["text-allow-overlap"]="false",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r["-x-mapnik-min-distance"]="0 "),("area"===a&&"grass"===t.landuse||"area"===a&&"grass"===t.natural||"area"===a&&"meadow"===t.natural||"area"===a&&"meadow"===t.landuse||"area"===a&&"recreation_ground"===t.landuse)&&(r["fill-color"]="#f4ffe5",r["z-index"]=4),"area"===a&&"wetland"===t.natural&&(r["z-index"]=4),("area"===a&&"farmland"===t.landuse||"area"===a&&"farm"===t.landuse||"area"===a&&"field"===t.landuse)&&(r["fill-color"]="#fff5c4",r["z-index"]=5),"area"===a&&"cemetery"===t.landuse&&(r["fill-color"]="#e5f5dc",r["z-index"]=5),"area"===a&&"aerodrome"===t.aeroway&&(r.color="#008ac6",r.width=.8,r["z-index"]=5),("area"===a&&"stadium"===t.leisure||"area"===a&&"pitch"===t.leisure)&&(r["fill-color"]="#e3deb1",r["z-index"]=5),"way"===i&&"river"===t.waterway&&(r.color="#C4D4F5",r.width=.9,r["z-index"]=9),"way"===i&&"stream"===t.waterway&&(r.color="#C4D4F5",r.width=.5,r["z-index"]=9),"way"===i&&"canal"===t.waterway&&(r.color="#abc4f5",r.width=.6,r["z-index"]=9),("area"===a&&"riverbank"===t.waterway||"area"===a&&"water"===t.natural||"area"===a&&"reservoir"===t.landuse)&&(r["fill-color"]="#C4D4F5",r.color="#C4D4F5",r.width=.1,r["z-index"]=9),"area"===a&&"water"===t.natural&&(r.text=f.default.e_localize(t,"name"),r["text-offset"]=1,r["font-size"]="10",r["font-family"]="DejaVu Serif Italic",r["text-color"]="#285fd1",r["text-allow-overlap"]="false",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff"),"way"===i&&"construction"===t.highway&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Book",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r["casing-width"]=.5,r["casing-color"]="#996703",r.width=2,r.color="#ffffff",r["z-index"]=10,r.dashes=[9,9]),"way"===i&&"construction"===t.highway&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Book",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r["casing-width"]=.5,r["casing-color"]="#996703",r.width=3,r.color="#ffffff",r["z-index"]=10,r.dashes=[9,9]),("way"===i&&"footway"===t.highway||"way"===i&&"path"===t.highway||"way"===i&&"cycleway"===t.highway||"way"===i&&"pedestrian"===t.highway)&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Book",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r["casing-width"]=.3,r["casing-color"]="#bf96ce",r.width=.2,r.color="#ffffff",r["z-index"]=10,r.dashes=[2,2]),"way"===i&&"steps"===t.highway&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Book",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r["casing-width"]=.3,r["casing-color"]="#ffffff",r.width=3,r.color="#bf96ce",r["z-index"]=10,r.dashes=[1,1],r.linecap="butt"),("way"===i&&"road"===t.highway||"way"===i&&"track"===t.highway)&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Book",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r.width=1.5,r.color="#ffffff",r["casing-width"]=.5,r["casing-color"]="#996703",r["z-index"]=9),("way"===i&&"road"===t.highway||"way"===i&&"track"===t.highway)&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Book",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r.width=2.5,r.color="#ffffff",r["casing-width"]=.5,r["casing-color"]="#996703",r["z-index"]=9),"way"===i&&"service"===t.highway&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Book",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r.width=1.2,r.color="#ffffff",r["casing-width"]=.3,r["casing-color"]="#996703",r["z-index"]=10),("way"===i&&"residential"===t.highway&&16===o||"way"===i&&"unclassified"===t.highway&&16===o||"way"===i&&"living_street"===t.highway&&16===o||"way"===i&&"service"===t.highway&&("-1"===t.living_street||"false"===t.living_street||"no"===t.living_street)&&"parking_aisle"!==t.service&&16===o)&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Book",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r.width=3.5,r.color="#ffffff",r["casing-width"]=.5,r["casing-color"]="#996703",r["z-index"]=10),("way"===i&&"residential"===t.highway||"way"===i&&"unclassified"===t.highway||"way"===i&&"living_street"===t.highway||"way"===i&&"service"===t.highway&&("-1"===t.living_street||"false"===t.living_street||"no"===t.living_street)&&"parking_aisle"!==t.service)&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Book",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r.width=4.5,r.color="#ffffff",r["casing-width"]=.5,r["casing-color"]="#996703",r["z-index"]=10),("way"===i&&"secondary"===t.highway&&16===o||"way"===i&&"secondary_link"===t.highway&&16===o||"way"===i&&"tertiary"===t.highway&&16===o||"way"===i&&"tertiary_link"===t.highway&&16===o)&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Bold",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r.width=7,r.color="#fcffd1",r["casing-width"]=.5,r["casing-color"]="#996703",r["z-index"]=11),("way"===i&&"secondary"===t.highway&&17===o||"way"===i&&"secondary_link"===t.highway&&17===o||"way"===i&&"tertiary"===t.highway&&17===o||"way"===i&&"tertiary_link"===t.highway&&17===o)&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Bold",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r.width=8,r.color="#fcffd1",r["casing-width"]=.5,r["casing-color"]="#996703",r["z-index"]=11),("way"===i&&"secondary"===t.highway&&18===o||"way"===i&&"secondary_link"===t.highway&&18===o||"way"===i&&"tertiary"===t.highway&&18===o||"way"===i&&"tertiary_link"===t.highway&&18===o)&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Bold",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r.width=9,r.color="#fcffd1",r["casing-width"]=.5,r["casing-color"]="#996703",r["z-index"]=11),("way"===i&&"primary"===t.highway&&16===o||"way"===i&&"primary_link"===t.highway&&16===o)&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Bold",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r.width=9,r.color="#fcea97",r["casing-width"]=.5,r["casing-color"]="#996703",r["z-index"]=12),("way"===i&&"primary"===t.highway&&17===o||"way"===i&&"primary_link"===t.highway&&17===o)&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Bold",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r.width=10,r.color="#fcea97",r["casing-width"]=.5,r["casing-color"]="#996703",r["z-index"]=12),("way"===i&&"primary"===t.highway&&18===o||"way"===i&&"primary_link"===t.highway&&18===o)&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Bold",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r.width=11,r.color="#fcea97",r["casing-width"]=.5,r["casing-color"]="#996703",r["z-index"]=12),("way"===i&&"trunk"===t.highway&&17===o||"way"===i&&"trunk_link"===t.highway&&17===o||"way"===i&&"motorway"===t.highway&&17===o||"way"===i&&"motorway_link"===t.highway&&17===o)&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Bold",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r.width=12,r.color="#ffd780",r["casing-width"]=1,r["casing-color"]="#996703",r["z-index"]=13),("way"===i&&"trunk"===t.highway&&18===o||"way"===i&&"trunk_link"===t.highway&&18===o||"way"===i&&"motorway"===t.highway&&18===o||"way"===i&&"motorway_link"===t.highway&&18===o)&&(r.text=f.default.e_localize(t,"name"),r["text-position"]="line",r["text-color"]="#404040",r["font-family"]="DejaVu Sans Bold",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r.width=13,r.color="#ffd780",r["casing-width"]=1,r["casing-color"]="#996703",r["z-index"]=13),("way"===i&&"trunk"===t.highway||"way"===i&&"trunk_link"===t.highway||"way"===i&&"motorway"===t.highway||"way"===i&&"motorway_link"===t.highway||"way"===i&&"primary"===t.highway||"way"===i&&"primary_link"===t.highway)&&(n.width=.3,n.color="#fa6478",n["z-index"]=14,n["-x-mapnik-layer"]="top"),"way"!==i||"1"!==t.oneway&&"true"!==t.oneway&&"yes"!==t.oneway||(r["line-style"]="arrows",r["z-index"]=15,r["-x-mapnik-layer"]="top"),"line"===a&&"rail"===t.railway&&(r.width=1.4,r.color="#606060",r["z-index"]=15),"line"===a&&"rail"===t.railway&&(l.width=1,l.color="#ffffff",l.dashes=[6,6],l["z-index"]=16),"way"===i&&"subway"===t.railway&&(r.width=3,r.color="#072889",r["z-index"]=15,r.dashes=[3,3],r.opacity=.3,r.linecap="butt",r["-x-mapnik-layer"]="top"),"way"===i&&"fence"===t.barrier&&(r.width=.3,r.color="black",r["z-index"]=16,r["-x-mapnik-layer"]="top"),"way"===i&&"wall"===t.barrier&&(r.width=.5,r.color="black",r["z-index"]=16,r["-x-mapnik-layer"]="top"),"way"!==i||"sport"!==t.marking||t.hasOwnProperty("colour")||t.hasOwnProperty("color")||(r.width=.5,r.color="#a0a0a0",r["z-index"]=16,r["-x-mapnik-layer"]="top"),("way"===i&&"sport"===t.marking&&"white"===t.colour||"way"===i&&"sport"===t.marking&&"white"===t.color)&&(r.width=1,r.color="white",r["z-index"]=16,r["-x-mapnik-layer"]="top"),("way"===i&&"sport"===t.marking&&"red"===t.colour||"way"===i&&"sport"===t.marking&&"red"===t.color)&&(r.width=1,r.color="#c00000",r["z-index"]=16,r["-x-mapnik-layer"]="top"),("way"===i&&"sport"===t.marking&&"black"===t.colour||"way"===i&&"sport"===t.marking&&"black"===t.color)&&(r.width=1,r.color="black",r["z-index"]=16,r["-x-mapnik-layer"]="top"),"node"===i&&"place_of_worship"===t.amenity&&(r.text=f.default.e_localize(t,"name"),r["text-color"]="#623f00",r["font-family"]="DejaVu Serif Italic",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r["text-offset"]=3,r["max-width"]=70),"area"===a&&"place_of_worship"===t.amenity&&(r.text=f.default.e_localize(t,"name"),r["text-color"]="#623f00",r["font-family"]="DejaVu Serif Italic",r["font-size"]="9",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r["text-offset"]=3,r["max-width"]=70,r["z-index"]=16,r.width=.1,r.color="#111111",r["text-opacity"]="1",r["fill-color"]="#777777",r["fill-opacity"]=.5),"area"===a&&"administrative"===t.boundary&&"2"===t.admin_level&&(r.width=.5,r.color="#202020",r.dashes=[6,4],r.opacity=.7,r["z-index"]=16),"area"===a&&"administrative"===t.boundary&&"3"===t.admin_level&&(r.width=1.3,r.color="#ff99cc",r.opacity=.5,r["z-index"]=16),"area"===a&&"administrative"===t.boundary&&"6"===t.admin_level&&(r.width=.5,r.color="#101010",r.dashes=[1,2],r.opacity=.6,r["z-index"]=16.1),"area"===a&&"administrative"===t.boundary&&"4"===t.admin_level&&(r.width=.7,r.color="#000000",r.dashes=[1,2],r.opacity=.8,r["z-index"]=16.3),"way"===i&&"tram"===t.railway&&(r["z-index"]=17),"node"===i&&"station"===t.railway&&"subway"!==t.transport&&(r.text=f.default.e_localize(t,"name"),r["text-offset"]=7,r["font-size"]="9",r["font-family"]="DejaVu Sans Mono Book",r["text-halo-radius"]=1,r["text-color"]="#000d6c",r["text-halo-color"]="#ffffff",r["text-allow-overlap"]="false",r["-x-mapnik-min-distance"]="0"),"node"===i&&"subway_entrance"===t.railway&&(r["z-index"]=17),"node"===i&&"subway_entrance"===t.railway&&t.hasOwnProperty("name")&&(r.text=f.default.e_localize(t,"name"),r["text-offset"]=11,r["font-size"]="9",r["font-family"]="DejaVu Sans Book",r["text-halo-radius"]=2,r["text-color"]="#1300bb",r["text-halo-color"]="#ffffff",r["text-allow-overlap"]="false",r["-x-mapnik-min-distance"]="0"),"node"===i&&"aerodrome"===t.aeroway&&(r.text=f.default.e_localize(t,"name"),r["text-offset"]=12,r["font-size"]="9",r["font-family"]="DejaVu Sans Condensed Bold",r["text-halo-radius"]=1,r["text-color"]="#1e7ca5",r["text-halo-color"]="#ffffff",r["text-allow-overlap"]="false",r["z-index"]=17),"node"===i&&"town"===t.place&&(r.text=f.default.e_localize(t,"name"),r["font-size"]="80",r["font-family"]="DejaVu Sans Book",r["text-color"]="#101010",r["text-opacity"]="0.2",r["text-allow-overlap"]="true",r["z-index"]=20),"node"===i&&"city"===t.place&&(r.text=f.default.e_localize(t,"name"),r["font-size"]="100",r["font-family"]="DejaVu Sans Book",r["text-color"]="#101010",r["text-opacity"]="0.3",r["text-allow-overlap"]="true",r["z-index"]=20),"node"===i&&"village"===t.place&&(r.text=f.default.e_localize(t,"name"),r["text-offset"]=1,r["font-size"]="9",r["font-family"]="DejaVu Sans Book",r["text-halo-radius"]=1,r["text-color"]="#606060",r["text-halo-color"]="#ffffff",r["text-allow-overlap"]="false"),"node"===i&&"hamlet"===t.place&&(r.text=f.default.e_localize(t,"name"),r["text-offset"]=1,r["font-size"]="8",r["font-family"]="DejaVu Sans Book",r["text-halo-radius"]=1,r["text-color"]="#505050",r["text-halo-color"]="#ffffff",r["text-allow-overlap"]="false"),("area"===a&&"nature_reserve"===t.landuse||"area"===a&&"park"===t.leisure)&&(r.text=f.default.e_localize(t,"name"),r["text-offset"]=1,r["font-size"]="10",r["font-family"]="DejaVu Serif Italic",r["text-halo-radius"]=0,r["text-color"]="#3c8000",r["text-halo-color"]="#ffffff",r["text-allow-overlap"]="false"),("way"===i&&"stream"===t.waterway||"way"===i&&"river"===t.waterway||"way"===i&&"canal"===t.waterway)&&(r.text=f.default.e_localize(t,"name"),r["font-size"]="9",r["font-family"]="DejaVu Sans Oblique",r["text-color"]="#547bd1",r["text-halo-radius"]=1,r["text-halo-color"]="#ffffff",r["text-position"]="line"),"node"===i&&"ocean"===t.place&&(r.text=f.default.e_localize(t,"name"),r["text-offset"]=0,r["font-size"]="11",r["font-family"]="DejaVu Sans Oblique",r["text-halo-radius"]=1,r["text-color"]="#202020",r["text-halo-color"]="#ffffff",r["z-index"]=-1,r["-x-mapnik-min-distance"]="0"),"node"===i&&"sea"===t.place&&(r.text=f.default.e_localize(t,"name"),r["text-offset"]=0,r["font-size"]="10",r["font-family"]="DejaVu Sans Oblique",r["text-halo-radius"]=1,r["text-color"]="#4976d1",r["text-halo-color"]="#ffffff",r["-x-mapnik-min-distance"]="0"),"node"===i&&"peak"===t.natural&&(r.text=f.default.e_localize(t,"name"),r["text-offset"]=3,r["font-size"]="7",r["font-family"]="DejaVu Sans Mono Book",r["text-halo-radius"]=0,r["text-color"]="#664229",r["text-halo-color"]="#ffffff",r["-x-mapnik-min-distance"]="0"),"area"===a&&"administrative"===t.boundary&&"6"===t.admin_level&&(r.text=f.default.e_localize(t,"name"),r["text-offset"]=-10,r["font-size"]="12",r["font-family"]="DejaVu Sans ExtraLight",r["text-halo-radius"]=1,r["text-color"]="#7848a0",r["text-halo-color"]="#ffffff"),"node"===i&&"suburb"===t.place&&(r.text=f.default.e_localize(t,"name"),r["font-size"]="12",r["font-family"]="DejaVu Sans ExtraLight",r["text-color"]="#7848a0",r["z-index"]=20),"area"===a&&t.hasOwnProperty("building")&&(r.width=.3,r.color="#cca352",r["z-index"]=17),"area"===a&&t.hasOwnProperty("building")&&19<=o&&(r.text=f.default.e_localize(t,"addr:housenumber"),r["text-halo-radius"]=1,r["text-position"]="center",r["font-size"]="8",r["-x-mapnik-min-distance"]="10",r.opacity=.8),"node"===i&&"milestone"===t.highway&&t.hasOwnProperty("pk")&&(r.text=f.default.e_localize(t,"pk"),r["font-size"]="7",r["text-halo-radius"]=5,r["-x-mapnik-min-distance"]="0"),"way"===i&&"line"===a&&void 0===t.highway&&(r.color="#000000",r.width=.5),"way"===i&&"line"===a&&void 0===t.highway&&(r.color="#000000",r.width=1),"way"===i&&"line"===a&&void 0===t.highway&&(r.color="#000000",r.width=1.5),Object.keys(r).length&&(e.default=r),Object.keys(n).length&&(e.centerline=n),Object.keys(l).length&&(e.ticks=l),Object.keys(s).length&&(e.label=s),e}}])&&r(t.prototype,o),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,o,i}()},{"./mapcss":9}],11:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=(e=e("./mapcss"))&&e.__esModule?e:{default:e};function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=a(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==a(e)?e:e+""}(i.key),i)}}o.default=function(){function c(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this._defaultCanvasStyles={strokeStyle:"rgba(0,0,0,0.5)",fillStyle:"rgba(0,0,0,0.5)",lineWidth:1,lineCap:"round",lineJoin:"round",textAlign:"center",textBaseline:"middle"}}return e=c,o=[{key:"defaultCanvasStyles",get:function(){return this._defaultCanvasStyles}},{key:"populateLayers",value:function(e,t,o){for(var i,a,r={},n=c.styleFeatures(e,t,o),l=0,s=n.length;l<s;l++)r[a=(a=(i=n[l]).style["-x-mapnik-layer"])?"top"===a?1e4:a:i.properties.layer||1e3]=r[a]||[],r[a].push(i);return r}},{key:"getStyle",value:function(e,t,o){var i,a,r=e.type;return"LineString"===r||"MultiLineString"===r?(i="way",a="line"):"Polygon"===r||"MultiPolygon"===r?(i="way",a="area"):"Point"!==r&&"MultiPoint"!==r||(a=i="node"),n.default.shared.restyle(o,e.properties,t,i,a)}},{key:"styleFeatures",value:function(e,t,o){for(var i,a,r,n,l,s=[],f=0,u=e.length;f<u;f++)for(i in a=e[f],r=c.getStyle(a,t,o)){if("default"===i)n=a;else for(l in n={},a)n[l]=a[l];n.kothicId=f+1,n.style=r[i],n.zIndex=r[i]["z-index"]||0,n.sortKey=n.zIndex,s.push(n)}return s.sort(function(e,t){return e.zIndex<t.zIndex?-1:t.zIndex<e.zIndex?1:0}),s}},{key:"getFontString",value:function(e,t,o){t=t||9;var i=(e=e||"")?e+", ":"",a=(e=e.toLowerCase(),[]);return"italic"!==o["font-style"]&&"oblique"!==o["font-style"]||a.push(o["font-style"]),"small-caps"===o["font-letiant"]&&a.push(o["font-letiant"]),"bold"===o["font-weight"]&&a.push(o["font-weight"]),a.push(t+"px"),-1!==e.indexOf("serif")&&-1===e.indexOf("sans-serif")?i+="Georgia, serif":i+='"Helvetica Neue", Arial, Helvetica, sans-serif',a.push(i),a.join(" ")}},{key:"setStyles",value:function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])}}],(t=null)&&i(e.prototype,t),o&&i(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,o}()},{"./mapcss":9}],12:[function(e,t,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var i=(e=e("./rbush"))&&e.__esModule?e:{default:e};function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=a(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==a(e)?e:e+""}(i.key),i)}}o.default=function(){function r(e,t){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");this.buffer=new i.default,this.height=e,this.width=t}return e=r,o=[{key:"getBoxFromPoint",value:function(e,t,o,i,a){t=t/2+i,o=o/2+i;return[e[0]-t,e[1]-o,e[0]+t,e[1]+o,a]}}],(t=[{key:"addPointWH",value:function(e,t,o,i,a){this.buffer.insert(r.getBoxFromPoint(e,t,o,i,a))}},{key:"addPoints",value:function(e){for(var t=[],o=0,i=e.length;o<i;o++)t.push(r.getBoxFromPoint.apply(this,e[o]));this.buffer.load(t)}},{key:"checkBox",value:function(e,t){var o,i,a=this.buffer.search(e);if(e[0]<0||e[1]<0||e[2]>this.width||e[3]>this.height)return!0;for(o=0,i=a.length;o<i;o++)if(t!==a[o][4])return!1;return!1}},{key:"checkPointWH",value:function(e,t,o,i){return this.checkBox(r.getBoxFromPoint(e,t,o,0),i)}}])&&n(e.prototype,t),o&&n(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,o}()},{"./rbush":14}],13:[function(e,t,o){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=a(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==a(e)?e:e+""}(i.key),i)}}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;o.default=function(){function i(){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function")}return e=i,o=[{key:"transformPoint",value:function(e,t,o){return[t*e[0],o*e[1]]}},{key:"transformPoints",value:function(e,t,o){for(var i=[],a=0,r=e.length;a<r;a++)void 0!==e[a]&&i.push(this.transformPoint(e[a],t,o));return i}},{key:"getReprPoint",value:function(e){var t,o;switch(e.type){case"Point":t=e.coordinates;break;case"Polygon":t=e.reprpoint;break;case"LineString":o=i.getPolyLength(e.coordinates),t=[(t=i.getAngleAndCoordsAtLength(e.coordinates,o/2,0))[1],t[2]];break;case"GeometryCollection":return;case"MultiPoint":return void console.log("MultiPoint");case"MultiPolygon":t=e.reprpoint;break;case"MultiLineString":return void console.log("MultiLineString")}return t}},{key:"getPolyLength",value:function(e){for(var t,o,i,a=e.length,r=0,n=1;n<a;n++)t=e[n],o=(i=e[n-1])[0]-t[0],i=i[1]-t[1],r+=Math.sqrt(o*o+i*i);return r}},{key:"getAngleAndCoordsAtLength",value:function(e,t,o){var i,a,r,n,l,s,f,u,c=e.length,h=0,d=!0,y=!1;for(o=o||0,n=1;n<c;n++){if(y&&(d=!1),i=(l=e[n])[0]-(f=e[n-1])[0],l=l[1]-f[1],s=Math.sqrt(i*i+l*l),!y&&t<=h+s&&(a=f[0]+i*(u=t-h)/s,r=f[1]+l*u/s,y=!0),y&&t+o<=h+s)return i=f[0]+i*(u=t+o-h)/s,l=f[1]+l*u/s,f=Math.atan2(l-r,i-a),d?[f,a,r,s-u]:[f,a,r,0];h+=s}}}],(t=null)&&r(e.prototype,t),o&&r(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,o}()},{}],14:[function(e,t,o){function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var o=0;o<t.length;o++){var i=t[o];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=a(e)||!e)return e;var o=e[Symbol.toPrimitive];if(void 0===o)return("string"===t?String:Number)(e);o=o.call(e,t||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==a(e)?e:e+""}(i.key),i)}}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;o.default=function(){function o(e,t){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");if(!(this instanceof o))return new o(e,t);this._maxEntries=Math.max(4,e||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),t&&this._initFormat(t),this.clear()}return e=o,(t=[{key:"all",value:function(){return this._all(this.data,[])}},{key:"search",value:function(e){var t=this.data,o=[],i=this.toBBox;if(this.intersects(e,t.bbox))for(var a,r,n,l,s=[];t;){for(a=0,r=t.children.length;a<r;a++)n=t.children[a],l=t.leaf?i(n):n.bbox,this.intersects(e,l)&&(t.leaf?o.push(n):contains(e,l)?this._all(n,o):s.push(n));t=s.pop()}return o}},{key:"load",value:function(e){if(e&&e.length)if(e.length<this._minEntries)for(var t=0,o=e.length;t<o;t++)this.insert(e[t]);else{var i,a=this._build(e.slice(),0,e.length-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(i=this.data,this.data=a,a=i),this._insert(a,this.data.height-a.height-1,!0)):this.data=a}return this}},{key:"insert",value:function(e){return e&&this._insert(e,this.data.height-1),this}},{key:"clear",value:function(){return this.data={children:[],height:1,bbox:this.empty(),leaf:!0},this}},{key:"remove",value:function(e){if(e)for(var t,o,i,a,r=this.data,n=this.toBBox(e),l=[],s=[];r||l.length;){if(r||(r=l.pop(),o=l[l.length-1],t=s.pop(),a=!0),r.leaf&&-1!==(i=r.children.indexOf(e)))return r.children.splice(i,1),l.push(r),this._condense(l),this;a||r.leaf||!contains(r.bbox,n)?o?(t++,r=o.children[t],a=!1):r=null:(l.push(r),s.push(t),r=(o=r).children[t=0])}return this}},{key:"toBBox",value:function(e){return e}},{key:"compareMinX",value:function(e,t){return e[0]-t[0]}},{key:"compareMinY",value:function(e,t){return e[1]-t[1]}},{key:"toJSON",value:function(){return this.data}},{key:"fromJSON",value:function(e){return this.data=e,this}},{key:"_all",value:function(e,t){for(var o=[];e;)e.leaf?t.push.apply(t,e.children):o.push.apply(o,e.children),e=o.pop();return t}},{key:"_build",value:function(e,t,o,i){var a=o-t+1,r=this._maxEntries;if(a<=r)u={children:e.slice(t,o+1),height:1,bbox:null,leaf:!0};else{i||(i=Math.ceil(Math.log(a)/Math.log(r)),r=Math.ceil(a/Math.pow(r,i-1)));var n,l,s,f,u={children:[],height:i,bbox:null},c=Math.ceil(a/r),h=c*Math.ceil(Math.sqrt(r));for(this.multiSelect(e,t,o,h,this.compareMinX),n=t;n<=o;n+=h)for(s=Math.min(n+h-1,o),this.multiSelect(e,n,s,c,this.compareMinY),l=n;l<=s;l+=c)f=Math.min(l+c-1,s),u.children.push(this._build(e,l,f,i-1))}return this.calcBBox(u,this.toBBox),u}},{key:"_chooseSubtree",value:function(e,t,o,i){for(var a,r,n,l,s,f,u,c;i.push(t),!t.leaf&&i.length-1!==o;){for(u=c=1/0,a=0,r=t.children.length;a<r;a++)n=t.children[a],s=this.bboxArea(n.bbox),(f=this.enlargedArea(e,n.bbox)-s)<c?(c=f,u=s<u?s:u,l=n):f===c&&s<u&&(u=s,l=n);t=l}return t}},{key:"_insert",value:function(e,t,o){var i=this.toBBox,o=o?e.bbox:i(e),a=[],i=this._chooseSubtree(o,this.data,t,a);for(i.children.push(e),this.extend(i.bbox,o);0<=t&&a[t].children.length>this._maxEntries;)this._split(a,t),t--;this._adjustParentBBoxes(o,a,t)}},{key:"_split",value:function(e,t){var o=e[t],i=o.children.length,a=this._minEntries,a=(this._chooseSplitAxis(o,a,i),{children:o.children.splice(this._chooseSplitIndex(o,a,i)),height:o.height});o.leaf&&(a.leaf=!0),this.calcBBox(o,this.toBBox),this.calcBBox(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(o,a)}},{key:"_splitRoot",value:function(e,t){this.data={children:[e,t],height:e.height+1},this.calcBBox(this.data,this.toBBox)}},{key:"_chooseSplitIndex",value:function(e,t,o){for(var i,a,r,n,l,s=n=1/0,f=t;f<=o-t;f++)r=this.distBBox(e,0,f,this.toBBox),i=this.distBBox(e,f,o,this.toBBox),a=this.intersectionArea(r,i),r=this.bboxArea(r)+this.bboxArea(i),a<s?(s=a,l=f,n=r<n?r:n):a===s&&r<n&&(n=r,l=f);return l}},{key:"_chooseSplitAxis",value:function(e,t,o){var i=e.leaf?this.compareMinX:this.compareNodeMinX,a=e.leaf?this.compareMinY:this.compareNodeMinY;this._allDistMargin(e,t,o,i)<this._allDistMargin(e,t,o,a)&&e.children.sort(i)}},{key:"_allDistMargin",value:function(e,t,o,i){e.children.sort(i);for(var a,r=this.toBBox,n=this.distBBox(e,0,t,r),l=this.distBBox(e,o-t,o,r),s=this.bboxMargin(n)+this.bboxMargin(l),f=t;f<o-t;f++)a=e.children[f],this.extend(n,e.leaf?r(a):a.bbox),s+=this.bboxMargin(n);for(f=o-t-1;t<=f;f--)a=e.children[f],this.extend(l,e.leaf?r(a):a.bbox),s+=this.bboxMargin(l);return s}},{key:"_adjustParentBBoxes",value:function(e,t,o){for(var i=o;0<=i;i--)this.extend(t[i].bbox,e)}},{key:"_condense",value:function(e){for(var t,o=e.length-1;0<=o;o--)0===e[o].children.length?0<o?(t=e[o-1].children).splice(t.indexOf(e[o]),1):this.clear():this.calcBBox(e[o],this.toBBox)}},{key:"_initFormat",value:function(e){var t=["return a"," - b",";"];this.compareMinX=new Function("a","b",t.join(e[0])),this.compareMinY=new Function("a","b",t.join(e[1])),this.toBBox=new Function("a","return [a"+e.join(", a")+"];")}},{key:"calcBBox",value:function(e,t){e.bbox=this.distBBox(e,0,e.children.length,t)}},{key:"distBBox",value:function(e,t,o,i){for(var a,r=this.empty(),n=t;n<o;n++)a=e.children[n],this.extend(r,e.leaf?i(a):a.bbox);return r}},{key:"empty",value:function(){return[1/0,1/0,-1/0,-1/0]}},{key:"extend",value:function(e,t){return e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[2]),e[3]=Math.max(e[3],t[3]),e}},{key:"compareNodeMinX",value:function(e,t){return e.bbox[0]-t.bbox[0]}},{key:"compareNodeMinY",value:function(e,t){return e.bbox[1]-t.bbox[1]}},{key:"bboxArea",value:function(e){return(e[2]-e[0])*(e[3]-e[1])}},{key:"bboxMargin",value:function(e){return e[2]-e[0]+(e[3]-e[1])}},{key:"enlargedArea",value:function(e,t){return(Math.max(t[2],e[2])-Math.min(t[0],e[0]))*(Math.max(t[3],e[3])-Math.min(t[1],e[1]))}},{key:"intersectionArea",value:function(e,t){var o=Math.max(e[0],t[0]),i=Math.max(e[1],t[1]),a=Math.min(e[2],t[2]),e=Math.min(e[3],t[3]);return Math.max(0,a-o)*Math.max(0,e-i)}},{key:"contains",value:function(e,t){return e[0]<=t[0]&&e[1]<=t[1]&&t[2]<=e[2]&&t[3]<=e[3]}},{key:"intersects",value:function(e,t){return t[0]<=e[2]&&t[1]<=e[3]&&e[0]<=t[2]&&e[1]<=t[3]}},{key:"multiSelect",value:function(e,t,o,i,a){for(var r,n=[t,o];n.length;)(o=n.pop())-(t=n.pop())<=i||(r=t+Math.ceil((o-t)/i/2)*i,this.select(e,t,o,r,a),n.push(t,r,r,o))}},{key:"select",value:function(e,t,o,i,a){for(var r,n,l,s,f,u,c;t<o;){for(600<o-t&&(r=o-t+1,n=i-t+1,l=Math.log(r),f=.5*Math.exp(2*l/3),l=.5*Math.sqrt(l*f*(r-f)/r)*(n-r/2<0?-1:1),s=Math.max(t,Math.floor(i-n*f/r+l)),f=Math.min(o,Math.floor(i+(r-n)*f/r+l)),this.select(e,s,f,i,a)),u=e[i],n=t,c=o,this.swap(e,t,i),0<a(e[o],u)&&this.swap(e,t,o);n<c;){for(this.swap(e,n,c),n++,c--;a(e[n],u)<0;)n++;for(;0<a(e[c],u);)c--}0===a(e[t],u)?this.swap(e,t,c):(c++,this.swap(e,c,o)),c<=i&&(t=c+1),i<=c&&(o=c-1)}}},{key:"swap",value:function(e,t,o){var i=e[t];e[t]=e[o],e[o]=i}}])&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,i}()},{}]},{},[1]);